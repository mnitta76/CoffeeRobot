{% load static %}
{% load django_bootstrap5 %}
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COFFEE ROBOT</title>
    {% bootstrap_css %}
    {% bootstrap_javascript %}
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">

</head>
<body>

<!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
<div id="sidebar">
    <button id="sidebarClose" class="btn btn-link text-white position-absolute top-0 end-0 m-2" style="font-size:1.2rem;">&times;</button>
{#    <div class="sidebar-item"><a href="/dashboard/" class="text-white text-decoration-none">ğŸ“‹ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a></div>#}
{#    <div class="sidebar-item"><a href="/coffee/" class="text-white text-decoration-none">â˜• ã‚³ãƒ¼ãƒ’ãƒ¼ãƒãƒ¼ãƒˆ</a></div>#}
{#    <div class="sidebar-item"><a href="/analytics/" class="text-white text-decoration-none">ğŸ“Š ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹</a></div>#}
    <div class="sidebar-item"><a href="/chat/" class="text-white text-decoration-none">ğŸ§  AIãƒãƒ£ãƒƒãƒˆ</a></div>
{#    <div class="sidebar-item"><a href="/tools/" class="text-white text-decoration-none">ğŸ§° ãƒ„ãƒ¼ãƒ«</a></div>#}
{#    <div class="sidebar-item"><a href="/settings/" class="text-white text-decoration-none">âš™ï¸ è¨­å®š</a></div>#}

    {% if user.is_authenticated %}
        <div class="sidebar-item">
            <form method="post" action="{% url 'logout' %}">{% csrf_token %}
                <button class="btn btn-link text-white p-0 text-decoration-none">ğŸšª ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
            </form>
        </div>
    {% else %}
        <div class="sidebar-item"><a href="{% url 'login' %}" class="text-white text-decoration-none">ğŸ” ãƒ­ã‚°ã‚¤ãƒ³</a></div>
        <div class="sidebar-item"><a href="{% url 'signup' %}" class="text-white text-decoration-none">ğŸ“ ä¼šå“¡ç™»éŒ²</a></div>
    {% endif %}
</div>

<div id="overlay"></div>

<!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
<nav class="navbar navbar-expand navbar-dark bg-dark position-relative">
    <div class="container">
        <!-- å·¦å´: ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
        {% if user.is_authenticated %}
        <button id="sidebarToggle" class="btn btn-link text-white position-absolute start-0">&#9776;</button>
        {% endif %}

        <!-- ä¸­å¤®: ãƒ–ãƒ©ãƒ³ãƒ‰åã‚’ã‚»ãƒ³ã‚¿ãƒ¼ -->
        <div class="mx-auto position-absolute start-50 translate-middle-x">
            <a href="/" class="navbar-brand text-center">COFFEE ROBOT</a>
        </div>

        <!-- å³å´: ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ -->
        <ul class="navbar-nav ms-auto">
            {% if user.is_authenticated %}
            <li class="nav-item">
                <form method="post" action="{% url 'logout' %}">
                    {% csrf_token %}
                    <button class="nav-link btn btn-link" type="submit">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
                </form>
            </li>
            {% else %}
            <li class="nav-item"><a href="{% url 'login' %}" class="nav-link">ãƒ­ã‚°ã‚¤ãƒ³</a></li>
            <li class="nav-item"><a href="{% url 'signup' %}" class="nav-link">ä¼šå“¡ç™»éŒ²</a></li>
            {% endif %}
        </ul>
    </div>
</nav>

<!-- ãƒ¡ã‚¤ãƒ³ -->
<main>
    <div class="container mt-4">
        {% block main %}{% endblock %}
    </div>
</main>

<!-- JS: ã‚µã‚¤ãƒ‰ãƒãƒ¼é–‹é–‰ -->
<script>
    const sidebar = document.getElementById("sidebar");
    const overlay = document.getElementById("overlay");
    const toggleBtn = document.getElementById("sidebarToggle");
    const closeBtn = document.getElementById("sidebarClose");
    const body = document.body;

    function getScrollbarWidth() {
        return window.innerWidth - document.documentElement.clientWidth;
    }

    function openSidebar() {
        sidebar.classList.add("active");
        overlay.classList.add("active");

        if (window.innerWidth <= 768) {
            const scrollbarWidth = getScrollbarWidth();
            body.style.paddingRight = `${scrollbarWidth}px`;
            body.classList.add("sidebar-open");
        }
    }

    function closeSidebar() {
        sidebar.classList.remove("active");
        overlay.classList.remove("active");

        body.classList.remove("sidebar-open");
        body.style.paddingRight = "";
    }

    // âœ… è¦ç´ ãŒå­˜åœ¨ã™ã‚‹ã¨ãã ã‘ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ ã™ã‚‹
    if (toggleBtn) {
        toggleBtn.addEventListener("click", openSidebar);
    }
    if (closeBtn) {
        closeBtn.addEventListener("click", closeSidebar);
    }
    if (overlay) {
        overlay.addEventListener("click", closeSidebar);
    }

    // Escã‚­ãƒ¼ã¯å¸¸ã«åå¿œOK
    document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
            closeSidebar();
        }
    });

</script>

</body>
</html>
